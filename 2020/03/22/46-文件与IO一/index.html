<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>Go语言从入门到放弃系列&lt;46&gt; 文件与IO&lt;一&gt; | 云钰的亭轩阁</title><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Go语言从入门到放弃系列&lt;46&gt; 文件与IO&lt;一&gt;</h1><a id="logo" href="/.">云钰的亭轩阁</a><p class="description">Running water never goes stale, so you gotta just keep on flowing.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Go语言从入门到放弃系列&lt;46&gt; 文件与IO&lt;一&gt;</h1><div class="post-meta"><a href="/2020/03/22/46-%E6%96%87%E4%BB%B6%E4%B8%8EIO%E4%B8%80/#comments" class="comment-count"></a><p><span class="date">Mar 22, 2020</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Hits</i></i></span></p></div><div class="post-content"><h2 id="Go语言从入门到放弃系列-lt-46-gt-文件与IO-lt-一-gt"><a href="#Go语言从入门到放弃系列-lt-46-gt-文件与IO-lt-一-gt" class="headerlink" title="Go语言从入门到放弃系列&lt;46&gt; 文件与IO&lt;一&gt;"></a>Go语言从入门到放弃系列&lt;46&gt; 文件与IO&lt;一&gt;</h2><p>&emsp;&emsp;在之前的几个章节中，我们分别介绍了Go语言中面向过程的部分与面向对象的部分的知识点。在这个小节中，我们将开始讲解Go语言中的文件操作，包括文件的创建、删除、读取、写入等操作。同时也就以上的几个知识点做出相对详细的讲解，并通过简单的案例完成入门代码。</p>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><p>&emsp;&emsp;在之前的各个章节的讲解中，我们经常会提到指针、内存等概念，但一直没有提到文件的使用。之前不论是通过键盘输入的还是通过计算得到的数据都是存储在内存中的。那么数据为什么不能够一直存储在内存中呢，其一个原因就是程序在关闭的时候、函数在结束的时候、乃至于出现故障突然掉电的情况下，对应区域内的内存数据会被清空而无法再次被寻找到。 </p>
<p>&emsp;&emsp;而文件的存在是处在硬盘中的，它具备掉电依旧保存的能力，因此我们将需要持久保存的数据写入文件中，以备出现故障等情况，亦或是在软件开发过程中就有写入文件的需求。从某种意义上讲，这个过程可以被称为持久化。一些具备丰富开发经验的人可能会想，在开发过程中往往会把数据存储在数据库这种服务软件中，其实究其本质，数据库中的数据存储方式依旧是通过文件所完成的。 </p>
<p>&emsp;&emsp;文件可以有很多种，而且不同的操作系统的文件也有所不同，但是不论怎样，计算机中的文件本质都是二进制。不论是音频数据、视频数据、亦或是文本数据，我们都可以以文件的形式进行操作。文件同时也具备读、写、执行等操作，只读的文件不可以被修改，只写的文件不可以被读等（当然可以通过一些操作修改其读写属性）。 </p>
<p>&emsp;&emsp;在Go语言中，对文件的操作基本都在于os包中，且核心结构体（类）为File类。下图是Golang文档中对于File相关的函数和方法的列表，我们将会针对其中几个进行讲解。 </p>
<p> <img src="/2020/03/22/46-%E6%96%87%E4%BB%B6%E4%B8%8EIO%E4%B8%80/1.png" alt><br>&emsp;&emsp;在上图中，我们可以发现，前五个是Go语言中的函数，而后续的多个均是File类所对应的方法，在使用的过程中需要注意。 </p>
<h3 id="文件的基本操作"><a href="#文件的基本操作" class="headerlink" title="文件的基本操作"></a>文件的基本操作</h3><p>&emsp;&emsp;在这个部分中，我们集中讲解文件的创建、裁剪、移动（重命名）、删除、和文件信息的获取。 </p>
<h4 id="1-创建文件"><a href="#1-创建文件" class="headerlink" title="1.创建文件"></a>1.创建文件</h4><p>&emsp;&emsp;在Go语言中，创建文件的所采用的是os包中的Create函数，其函数参数为希望创建的文件的路径，返回值为文件指针以及错误类型。创建模式为0666，权限模式为任何人可以读写不可以执行。值得说明的是，此处所使用的文件路径既可以是相对路径，也可以是绝对路径。相对路径是希望创建的位置与当前Go文件的相对关系，例如我们希望在当前路径的上一级创建文件，则可以使用”../xxx.txt”的方式。绝对路径则是从根目录（Windows中从对应盘符）开始逐级向下明确指明位置，最后进行创建。 </p>
<p>&emsp;&emsp;因此创建文件的方式相对容易，通过Create函数创建，再通过error类型判断是否创建成功即可：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> file *os.File</span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    file, err = os.Create(<span class="string">"text.txt"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"创建失败"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(file)</span><br><span class="line">    file.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在上述代码中，我们首先定义了file变量用来承接File指针，也定义了error变量。然后通过这两个变量作为Create函数的返回值。然后我们判断err是否为空，如果err不为空（说明有错误）则输出创建失败。然后我们输出了file的值，最后关闭文件。 </p>
<p>&emsp;&emsp;此时我们创建的text.txt是相对路径，相对于当前目录下创建了一个空的名为text的文本文件。然后在控制台中输出的是file指针所对应的地址。需要注意的一点是创建文件的时候，文件所存储的目录一定需要存在，即在文件系统中真实存在这个目录，否则文件创建会失败，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file, err = os.Create(<span class="string">"aaa/text.txt"</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;由于当前Go文件所在的目录下并没有aaa的文件夹，因此文件创建是失败的。还有一点需要注意的是如果当前文件已经存在，则会将已存在的文件清空，因此在创建文件的时候需要十分注意，以免影响到原有的文件。</p>
<h4 id="2-文件裁剪"><a href="#2-文件裁剪" class="headerlink" title="2.文件裁剪"></a>2.文件裁剪</h4><p>&emsp;&emsp;文件裁剪采用os包下Truncate函数来完成，其核心功能是将文件裁剪到对应的大小。函数参数是一个int64类型的数，指明将文件裁剪到固定的大小。例如我们在第一个小点中创建了一个text文件，此时该文件的大小是0字节，里面没有任何的内容，此时我们通过这个函数将其裁剪为100字节：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    err := os.Truncate(<span class="string">"text.txt"</span>, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;此时我们再看文件的属性，发现此时该文本文件为100字节，且其中的内容为100个空字符。那么假如一个文件原有大小为200字节，我们将其裁剪为100字节，则超出的100字节全部<strong>舍弃</strong>；假如文件不足100字节，则不足的字节均由空值所占据。如果没有text这个文件，则直接创建100个字节的该文件。</p>
<h4 id="3-移动（重命名文件）"><a href="#3-移动（重命名文件）" class="headerlink" title="3.移动（重命名文件）"></a>3.移动（重命名文件）</h4><p>&emsp;&emsp;在Go语言中，移动文件和重命名一个文件所采用的的方式是相同的，均是通过Rename函数完成的。既然是移动文件，函数参数当然是两个文件文件路径，且返回值为移动（重命名）是否成功。这个函数并不难理解，因此我们直接通过代码进行快速入门：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    oldFile := <span class="string">"text.txt"</span></span><br><span class="line">    newFile := <span class="string">"newText.txt"</span></span><br><span class="line">    err := os.Rename(oldFile, newFile)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"移动失败"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在这个函数中，新旧文件的文件路径可以是相同的，但是旧文件必须是可以被找到的，否则在运行时会报错。同理因为新文件相当于是创建文件，因此新文件所处在的文件路径依旧需要是存在的，否则也会运行时报错。</p>
<h4 id="4-删除文件（目录）"><a href="#4-删除文件（目录）" class="headerlink" title="4. 删除文件（目录）"></a>4. 删除文件（目录）</h4><p>&emsp;&emsp;当文件已经存在时，可以通过Remove函数来完成文件或目录的删除工作。同理，Remove函数的参数为希望删除的文件或目录的路径，包括相对路径和绝对路径。返回值依旧是error对象，来验证删除是否成功。此时我们将当前文件夹中的newText文件删除：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    file := <span class="string">"newText.txt"</span></span><br><span class="line">    err := os.Remove(file)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"删除失败"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在Go语言中还有一个RemoveAll函数，这两个函数的区别为：RemoveAll函数可以删除指定path的文件，或者目录<strong>以及它下属的所有文件或目录</strong>。因此它会尝试删除所有的东西，直到出现错误。</p>
<h4 id="5-获取文件信息"><a href="#5-获取文件信息" class="headerlink" title="5. 获取文件信息"></a>5. 获取文件信息</h4><p>&emsp;&emsp;一个文件可以有许多的属性，例如文件位置，文件大小，文件权限等等。这些属性可以通过Go语言中Stat函数（方法）来完成。之所以这样讲是因为Go语言在os包中提供了Stat函数，同时也在File类中提供了Stat方法，这两种获取方式结果是大致相似的。其获取结果FileInfo类定义如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FileInfo <span class="keyword">interface</span> &#123;</span><br><span class="line">    Name() <span class="keyword">string</span>    <span class="comment">// 文件的名字（不含扩展名）</span></span><br><span class="line">    Size() <span class="keyword">int64</span>    <span class="comment">// 普通文件返回值表示其大小；其他文件的返回值含义各系统不同</span></span><br><span class="line">    Mode() FileMode   <span class="comment">// 文件的模式位</span></span><br><span class="line">    ModTime() time.Time <span class="comment">// 文件的修改时间</span></span><br><span class="line">    IsDir() <span class="keyword">bool</span>    <span class="comment">// 等价于Mode().IsDir()</span></span><br><span class="line">    Sys() <span class="keyword">interface</span>&#123;&#125;  <span class="comment">// 底层数据来源（可以返回nil）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可以发现，Stat函数（方法）的返回值是error变量和一个接口，通过这个接口实例可以调用相应的方法，得到文件名、文件大小、文件权限、修改时间等。我们经常通过这个函数来判断文件是否存在：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fileInfo, err := os.Stat(<span class="string">"text.txt"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line">            fmt.Println(<span class="string">"文件不存在"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(fileInfo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>&emsp;&emsp;在这个小节中，我们主要讲解了Go语言中的文件的概念，使用场景，以及文件的基本操作，如创建、删除、移动等函数。在下个小节中，我们依旧针对文件的读写、拷贝等方式进行讲解。可以说，文件这两小节中我讲解的并不多，只是一些基本的操作方法，其实Go语言开发者为我们提供了更多的文件方法与函数。如果在日常开发中遇到文件相关的操作，API文档将会是一个更好的选择。</p>
</div><div class="tags"><a href="/tags/Go%E8%AF%AD%E8%A8%80/">Go语言</a></div><div class="post-share"></div><div class="post-nav"><a href="/2020/03/24/47-%E6%96%87%E4%BB%B6%E4%B8%8EIO%E4%BA%8C/" class="pre">Go语言从入门到放弃系列&lt;47&gt; 文件与IO&lt;二&gt;</a><a href="/2020/03/21/45-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E5%A4%9A%E6%80%81/" class="next">Go语言从入门到放弃系列&lt;45&gt; 面向对象-多态</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Contents</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Go语言从入门到放弃系列-lt-46-gt-文件与IO-lt-一-gt"><span class="toc-text">Go语言从入门到放弃系列&lt;46&gt; 文件与IO&lt;一&gt;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文件"><span class="toc-text">文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件的基本操作"><span class="toc-text">文件的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建文件"><span class="toc-text">1.创建文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-文件裁剪"><span class="toc-text">2.文件裁剪</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-移动（重命名文件）"><span class="toc-text">3.移动（重命名文件）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-删除文件（目录）"><span class="toc-text">4. 删除文件（目录）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-获取文件信息"><span class="toc-text">5. 获取文件信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-text">小结</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/04/55-%E5%8F%8D%E5%B0%84%E7%BB%86%E8%8A%82%E8%AE%A8%E8%AE%BA/">Go语言从入门到放弃系列<55> 反射细节讨论</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/02/54-%E5%8F%8D%E5%B0%84%E5%85%A5%E9%97%A8/">Go语言从入门到放弃系列<54> 反射入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/53-channel%E7%BB%86%E8%8A%82%E8%AE%A8%E8%AE%BA/">Go语言从入门到放弃系列<53> channel细节讨论</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/30/52-channel%E7%AE%A1%E9%81%93%E5%85%A5%E9%97%A8/">Go语言从入门到放弃系列<52> channel管道入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/51-%E8%B5%84%E6%BA%90%E7%AB%9E%E4%BA%89%E4%B8%8E%E7%AE%A1%E9%81%93/">Go语言从入门到放弃系列<51> 资源竞争与管道</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/27/50-Goroutine%E5%85%A5%E9%97%A8/">Go语言从入门到放弃系列<50> Goroutine入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/26/49-Goroutine%E6%A6%82%E5%BF%B5%E7%AE%80%E4%BB%8B/">Go语言从入门到放弃系列<49> Goroutine概念简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/25/48-JSON%E4%B8%8E%E5%BA%8F%E5%88%97%E5%8C%96/">Go语言从入门到放弃系列<48> JSON与序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/24/47-%E6%96%87%E4%BB%B6%E4%B8%8EIO%E4%BA%8C/">Go语言从入门到放弃系列<47> 文件与IO<二></a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/22/46-%E6%96%87%E4%BB%B6%E4%B8%8EIO%E4%B8%80/">Go语言从入门到放弃系列<46> 文件与IO<一></a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"><a href="/tags/Go%E8%AF%AD%E8%A8%80/" style="font-size: 15px;">Go语言</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archive</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">55</span></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Site Map</a> |  <a href="/atom.xml">Subscribe to this site</a> |  <a href="/about/">Contact the blogger</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Devin DENG.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script></body></html>